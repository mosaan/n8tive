# n8tive 開発レポート - 2025/12/13 #6

## 作業概要
n8n データフォルダの二重ディレクトリ構造を解消し、ドキュメントにデータ保存場所の詳細情報を追記。

## 実施内容

### 1. 問題の発見と分析
- n8n のデータが `.n8n/.n8n/` という二重ディレクトリ構造で保存されていることを発見
- 実際のデータベースファイル: `C:\Users\moref\AppData\Roaming\n8tive\.n8n\.n8n\database.sqlite`
- 原因: `N8N_USER_FOLDER` に `app.getPath('userData')/.n8n` を設定していたが、n8n は内部的に `N8N_USER_FOLDER/.n8n` を作成する仕様

### 2. n8n-manager.ts の修正
**修正箇所:** `src/main/n8n-manager.ts:35-38`

**修正前:**
```typescript
const userDataPath = app.getPath('userData');
const n8nUserFolder = join(userDataPath, '.n8n');
```

**修正後:**
```typescript
const userDataPath = app.getPath('userData');
// n8nは内部的にN8N_USER_FOLDER/.n8nを作成するため、
// userDataPathをそのまま指定する
const n8nUserFolder = userDataPath;
```

### 3. ドキュメントの整備

#### `docs/02_ImplementationDetails.md` に追加
- **n8n-manager.ts セクション**: データ保存場所の説明を追記
- **新規セクション「データ保存場所」**: 以下の詳細情報を追加
  - ユーザーデータディレクトリ（OS 別のパス）
  - n8n データフォルダの構造
  - 保存されるデータの一覧

#### 既存ドキュメントの修正
- `docs/00_ProjectPlan.md:11` - データパスの記載を修正
- `docs/01_Architecture.md:9, 58` - データ永続性の記載を修正
- `docs/03_MainProcess.md:93-95` - 実装例のコードを修正

### 4. 動作確認
アプリを再起動して、新しいデータフォルダ構造を確認：

**修正前:**
```
C:\Users\moref\AppData\Roaming\n8tive\.n8n\.n8n\database.sqlite
```

**修正後:**
```
C:\Users\moref\AppData\Roaming\n8tive\.n8n\database.sqlite
```

二重ディレクトリ構造が解消され、正しいパス構造になったことを確認。

## 技術的な発見

### n8n のデータフォルダ仕様
n8n は `N8N_USER_FOLDER` 環境変数で指定されたディレクトリ内に、自動的に `.n8n` サブディレクトリを作成する。

- 設定値: `N8N_USER_FOLDER = app.getPath('userData')`
- 実際の保存先: `{N8N_USER_FOLDER}/.n8n/`

### OS 別のデータ保存場所
- **Windows**: `%APPDATA%\n8tive\.n8n\`
- **macOS**: `~/Library/Application Support/n8tive/.n8n/`
- **Linux**: `~/.config/n8tive/.n8n/`

### 保存されるデータ
- `database.sqlite` - ワークフロー、実行履歴、認証情報
- `config` - n8n 設定
- `n8nEventLog.log` - イベントログ
- `binaryData/` - バイナリデータ
- `nodes/` - カスタムノード
- `ssh/`, `git/` - Git 統合

## 修正ファイル一覧
- `src/main/n8n-manager.ts` - N8N_USER_FOLDER の設定を修正
- `docs/02_ImplementationDetails.md` - データ保存場所セクションを追加
- `docs/00_ProjectPlan.md` - 成功基準の記載を修正
- `docs/01_Architecture.md` - データ永続性の記載を修正（2箇所）
- `docs/03_MainProcess.md` - 実装例のコードを修正

## 次のステップ

### 短期
- 既存の古いデータ（`.n8n/.n8n/`）のマイグレーション処理を検討（オプション）
- ワークフローの作成・実行テストを継続

### 中期
`docs/00_ProjectPlan.md` の Phase に沿って：
- **Phase 2**: N8nManager実装の確認・改善（進行中）
- **Phase 3**: UI統合（loading.html, エラーハンドリング）
- **Phase 4**: ビルド・パッケージング（各OS向け）

## 所感
n8n の内部仕様を正しく理解することで、二重ディレクトリ構造という不要な複雑さを解消できた。ドキュメントにデータ保存場所の詳細を記載したことで、今後の開発や運用時のトラブルシューティングが容易になる。
